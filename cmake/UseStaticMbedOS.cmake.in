find_package(static-mbed-os-@MBED_TARGET@ REQUIRED)

include(StaticMbedOSToolchain-@MBED_TARGET@)
string(REPLACE " -Wl,--cref" "" CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS}")


# MbedOS-like library should be satisfied the following conditions:
# - good INTERFACE_COMPILE_OPTIONS
# - good INTERFACE_DEFINITIONS
# - good INTERFACE_INCLUDE_DIRECTORIES
# for link, it should satisfy the following conditions:
# - good INTERFACE_LINK_OPTIONS
# - has good .a file
set_target_properties(mbed-os::static-mbed-os-@MBED_TARGET@ PROPERTIES
  INTERFACE_LINK_OPTIONS "${STATIC_MBED_OS_@MBED_TARGET@_EXE_LINKER_FLAGS} "
  INTERFACE_COMPILE_OPTIONS "${STATIC_MBED_OS_@MBED_TARGET@_CXX_FLAGS} "
)


set(CMAKE_OBJCOPY /usr/bin/arm-none-eabi-objcopy)
set(CMAKE_OBJDUMP /usr/bin/arm-none-eabi-objdump)

include(StaticMbedOSTransformers)
function(static_mbed_os_app_target_@mbed_target@ target)
  target_link_options(${target} PRIVATE "-T" "@linker_script@")
  set_property(TARGET ${target} APPEND PROPERTY LINK_DEPENDS "@linker_script@")

  static_mbed_os_transform_rules(${target})
endfunction()